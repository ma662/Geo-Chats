<!DOCTYPE html>
<html lang="en-us">

<head>
    <title>Geolocation Test</title>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script rel="text/javascript" src="./assets/api/pubnub.js"></script>
</head>

<body>
    <button id="get-location">Click Me!</button>
</body>
<script>
    // Test GPS API
    // Location button click
    $("#get-location").on("click", function () {
        $('#map').css('display', 'block');

        // ipdata API Key
        var queryURL = "https://api.ipdata.co/?api-key=dbd74d08fb61a09922523a741a0c6feea9c5a1f578aeaf124dfe7cd9";

        // Function to create/send the API call or request
        $.ajax({
            url: queryURL,
            method: "GET"
        }).then(function (response) {
            var userCity = response.city;
            var userRegion = response.region;
            var userLatitude = response.latitude;
            var userLongitude = response.longitude;
            console.log(userCity, userRegion, userLatitude, userLongitude);
        });
    });

    // Function for google API
    function geolocationSuccess(position) {
        var userLatLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
        var myOptions = {
            zoom: 14,
            center: userLatLng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        // Draw the map
        var mapObject = new google.maps.Map(document.getElementById("map"), myOptions);

        // Place the marker
        new google.maps.Marker({
            map: mapObject,
            position: userLatLng
        });
    }

    function geolocationError(positionError) {
        document.getElementById("error").innerHTML += "Error: " + positionError.message + "<br />";
    }

    function geolocateUser() {
        if (navigator.geolocation) {
            var positionOptions = {
                enableHighAccuracy: true,
                timeout: 10 * 1000
            };
            navigator.geolocation.getCurrentPosition(geolocationSuccess, geolocationError, positionOptions);
        }
        else
            document.getElementById("error").innerHTML += "Your browser doesn't support the Geolocation API";
    }

    window.onload = geolocateUser;
    // End GPS API


    var but = $('<button>').text("Send Message").appendTo(document.body);

    but.on("click", function () {
        // test PubNub
        var pubnub = new PubNub({
            subscribeKey: "sub-c-ab63bdce-168b-11e9-b552-46d61eed2fbc",
            publishKey: "pub-c-1e89d8ed-eb9a-4ed0-832c-7a5d884df847",
            // cipherKey: "myCipherKey",
            authKey: "myles",
            logVerbosity: true,
            uuid: "myles",
            ssl: true,
            presenceTimeout: 130
        });

        pubnub.subscribe({
            channels: ['region_jersey-city']
        });

        var message = prompt("What would you like to say?");

        pubnub.publish({
            message: {
                such: message
            },
            channel: 'region_jersey-city',
            sendByPost: false, // true to send via post
            storeInHistory: false, //override default storage options
            meta: {
                "cool": "meta"
            }   // publish extra meta with the request
        }, function (status, response) {
            if (status.error) {
                // handle error
                console.log(status)
            } else {
                console.log("message Published w/ timetoken", response.timetoken)
            }
        }
        );
        console.log("I think I am working");
    });
</script>

</html>